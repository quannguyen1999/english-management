<div class="flex h-screen bg-white">
  <!-- Left Sidebar - Chat List -->
  <div class="w-[360px] flex flex-col">
    <!-- Header -->
    <div class="p-4 flex justify-between items-center" roughBox>
      <h1 class="text-2xl text-gray-800 sketch-text">{{ 'CHAT.TITLE' | translate }}</h1>
      <div class="grid grid-cols-3 gap-2">
        <button class="p-2 text-gray-600 hover:text-red-600 transition-colors" roughBox (click)="onLogout()">
          <mat-icon>logout</mat-icon>
        </button>
        <button class="p-2 text-gray-600 hover:text-blue-600 transition-colors" roughBox (click)="onProfile()">
          <mat-icon>account_circle</mat-icon>
        </button>
        <button class="p-2 text-gray-600 hover:text-green-600 transition-colors" roughBox (click)="onNewChat()">
          <mat-icon>chat_add</mat-icon>
        </button>
      </div>
    </div>

    <!-- Search Box -->
    <div class="px-4 mb-4 mt-4">
      <div class="flex items-center bg-gray-100 rounded-lg p-2" roughBox>
        <span class="text-gray-500 mr-2">üîç</span>
        <input 
          type="text" 
          [(ngModel)]="searchQuery"
          (keyup.enter)="onSearch($event)"
          [placeholder]="'CHAT.SEARCH_PLACEHOLDER' | translate" 
          class="bg-transparent w-full focus:outline-none text-gray-700">
      </div>
    </div>

    <!-- Online Users -->
    <div class="px-4 mb-4" *ngIf="!searchQuery">
      <div class="flex space-x-4 overflow-x-auto pb-2 scrollbar-hide" horizontalScroll>
        <div *ngFor="let user of onlineUsers" 
             class="flex flex-col items-center space-y-1 min-w-[4rem]">
          <div class="relative rounded-full border-1 border-black p-1 cursor-pointer">
            <img [src]="user.avatar" 
                 [alt]="user.name"
                 class="w-10 h-10 rounded-full object-cover">
            <span *ngIf="user.isOnline" 
                  class="absolute bottom-0 right-0 w-3 h-3 bg-green-500 rounded-full border-2 border-white"></span>
          </div>
          <span class="text-xs text-gray-800 text-center sketch-text">{{user.name}}</span>
        </div>
      </div>
    </div>

    <!-- Update Notice
    <div class="mx-4 mb-4" *ngIf="showUpdateNotice" roughBox>
      <div class="p-4 bg-white">
        <h3 class="text-lg mb-2 text-gray-800 sketch-text">Restart to use the latest version</h3>
        <p class="text-gray-600 text-sm mb-4 sketch-text">To make sure you're on the fastest and most up-to-date version, restart the app.</p>
        <button class="w-full p-2 bg-gray-100 text-gray-800" roughBox>
          Restart
        </button>
      </div>
    </div> -->

    <!-- Recent Chats -->
    <div class="flex-1 overflow-y-auto">
      <div *ngFor="let chat of (searchQuery ? filteredUsers : recentChats)" 
           (click)="onChatSelect(chat)"
           class="px-4 py-2 flex items-center space-x-3 hover:bg-gray-50 cursor-pointer">
        <div class="relative">
          <img [src]="chat.avatar" 
               [alt]="chat.name"
               class="w-12 h-12 rounded-full object-cover">
          <span *ngIf="chat.isOnline" 
                class="absolute bottom-0 right-0 w-3 h-3 bg-green-500 rounded-full border-2 border-white"></span>
        </div>
        <div class="flex-1 min-w-0">
          <div class="flex justify-between items-baseline">
            <h3 class="text-sm font-medium text-gray-900 truncate">{{chat.name}}</h3>
            <span class="text-xs text-gray-500">{{chat.lastMessageTime}}</span>
          </div>
          <p class="text-sm text-gray-500 truncate">{{chat.lastMessage}}</p>
          <div class="flex mt-1">
            <!-- Add Friend Button -->
            <button *ngIf="chat.friendStatus === FriendStatus.NONE" 
                    (click)="addFriend(chat); $event.stopPropagation()"
                    class="px-3 py-1 text-xs text-blue-600 hover:bg-blue-50 rounded-full mr-2"
                    roughBox>
              {{ 'FRIENDS.ADD_FRIEND' | translate }}
            </button>

            <!-- Pending Sent Status -->
            <div *ngIf="chat.friendStatus === FriendStatus.PENDING_SENT"
                 class="flex items-center text-xs text-gray-500">
              <span class="mr-2">‚úâÔ∏è</span>
              {{ 'FRIENDS.PENDING' | translate }}
            </div>

            <!-- Pending Received Actions -->
            <ng-container *ngIf="chat.friendStatus === FriendStatus.PENDING_RECEIVED">
              <button (click)="acceptFriendRequest(chat); $event.stopPropagation()"
                      class="px-3 py-1 text-xs text-green-600 hover:bg-green-50 rounded-full mr-2"
                      roughBox>
                {{ 'FRIENDS.ACCEPT' | translate }}
              </button>
              <button (click)="rejectFriendRequest(chat); $event.stopPropagation()"
                      class="px-3 py-1 text-xs text-red-600 hover:bg-red-50 rounded-full"
                      roughBox>
                {{ 'FRIENDS.DECLINE' | translate }}
              </button>
            </ng-container>

            <!-- Remove Friend Button -->
            <button *ngIf="chat.friendStatus === FriendStatus.ACCEPTED" 
                    (click)="removeFriend(chat); $event.stopPropagation()"
                    class="px-3 py-1 text-xs text-red-600 hover:bg-red-50 rounded-full"
                    roughBox>
              {{ 'FRIENDS.REMOVE' | translate }}
            </button>
          </div>
        </div>
      </div>
      <!-- No Results Message -->
      <div *ngIf="searchQuery && filteredUsers.length === 0" 
           class="p-4 text-center text-gray-500">
        {{ 'SOCIAL.NO_USERS' | translate }}
      </div>
    </div>

    <!-- Search Results
    <div class="mx-4 mb-4" *ngIf="searchQuery && filteredUsers.length > 0" roughBox>
      <div class="p-4 bg-white">
        <h3 class="text-lg mb-2 text-gray-800 sketch-text">Search Results</h3>
        <div class="space-y-2">
          <div *ngFor="let user of filteredUsers" 
               (click)="onChatSelect(user)"
               class="p-2 flex items-center space-x-3 hover:bg-gray-50 cursor-pointer">
            <div class="relative">
              <img [src]="user.avatar" 
                   [alt]="user.name"
                   class="w-10 h-10 rounded-full object-cover">
              <span *ngIf="user.isOnline" 
                    class="absolute bottom-0 right-0 w-2 h-2 bg-green-500 rounded-full border-2 border-white"></span>
            </div>
            <div class="flex-1">
              <p class="text-sm font-medium text-gray-900">{{user.name}}</p>
              <p class="text-xs text-gray-500">{{user.friendStatus === 'friend' ? 'Friend' : 'Not a friend'}}</p>
            </div>
          </div>
        </div>
      </div>
    </div> -->

    <!-- Loading State -->
    <div class="mx-4 mb-4" *ngIf="searchQuery && isLoading" roughBox>
      <div class="p-4 bg-white">
        <div class="flex justify-center items-center h-20">
          <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"></div>
        </div>
      </div>
    </div>

    <!-- No Results -->
    <div class="mx-4 mb-4" *ngIf="searchQuery && !isLoading && filteredUsers.length === 0" roughBox>
      <div class="p-4 bg-white">
        <p class="text-center text-gray-500">{{ 'SOCIAL.NO_USERS' | translate }}</p>
      </div>
    </div>
  </div>

  <!-- Right Side - Chat Detail -->
  <div class="flex-1 border-r border-gray-200 border-2">
    <ng-container *ngIf="selectedChat; else welcomeMessage">
      <app-chat-detail 
        [chatUser]="selectedChat"
      ></app-chat-detail>
    </ng-container>
    
    <ng-template #welcomeMessage>
      <div class="h-full flex flex-col items-center justify-center p-10 text-center" roughBox>
        <div class="max-w-86 p-10" roughBox>
          <h1 class="text-2xl font-bold text-gray-800 mb-4 sketch-text">{{ 'CHAT.WELCOME' | translate }}</h1>
          <p class="text-gray-600 mb-6">{{ 'CHAT.WELCOME_MESSAGE' | translate }}</p>
          <div class="flex justify-center space-x-4">
            <button (click)="onNewChat()" class="px-4 py-2 bg-blue-100 text-blue-600 rounded-full hover:bg-blue-200" roughBox>
              {{ 'CHAT.NEW_CHAT' | translate }}
            </button>
          </div>
        </div>
      </div>
    </ng-template>
  </div>
</div> 